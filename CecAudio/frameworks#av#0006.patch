From 63aadc4ba5f5265ea2cc948c2aecd40de896e6ac Mon Sep 17 00:00:00 2001
From: Jinping Wang <jinping.wang@amlogic.com>
Date: Fri, 3 Aug 2018 17:43:36 +0800
Subject: [PATCH] cec: add pass through for playback [2/2]

PD# 170574

add pass through for playback

Change-Id: Ief05d68cafd11420fc54f97456ac65f45b7eb47b
---
 services/audioflinger/Threads.cpp | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/services/audioflinger/Threads.cpp b/services/audioflinger/Threads.cpp
index 893e4bf..9bc2d58 100644
--- a/services/audioflinger/Threads.cpp
+++ b/services/audioflinger/Threads.cpp
@@ -544,6 +544,9 @@ status_t AudioFlinger::ThreadBase::readyToRun()
 void AudioFlinger::ThreadBase::exit()
 {
     ALOGV("ThreadBase::exit");
+
+    property_set("audio.passthrough.enable", "false");
+
     // do any cleanup required for exit to succeed
     preExit();
     {
@@ -2516,6 +2519,17 @@ void AudioFlinger::PlaybackThread::readOutputParameters_l()
 
     // Get actual HAL format.
     status_t result = mOutput->stream->getFormat(&mHALFormat);
+    switch (mHALFormat) {
+        case AUDIO_FORMAT_E_AC3:
+        case AUDIO_FORMAT_AC3:
+        case AUDIO_FORMAT_DTS:
+        case AUDIO_FORMAT_DTS_HD:
+            property_set("audio.passthrough.enable", "true");
+            break;
+        default:
+            property_set("audio.passthrough.enable", "false");
+            break;
+    }
     LOG_ALWAYS_FATAL_IF(result != OK, "Error when retrieving output stream format: %d", result);
     // Get format from the shim, which will be different than the HAL format
     // if playing compressed audio over HDMI passthrough.
-- 
1.9.1

